name: Golang CI

on:
  workflow_call:
    inputs:
      go-version:
        description: 'The version of Go to use'
        required: true
        type: string
      use-private-module:
        description: 'Flag to use private module'
        default: false
        type: boolean
      github-owner:
        description: 'The GitHub owner of the private module'
        required: false
        type: string
    secrets:
      GH_TOKEN:
        description: 'The GitHub token to use for importing private module'
        required: false

permissions:
  contents: read
  packages: read
  statuses: write

jobs:
  lint:
    uses: ./.github/workflows/golangci-lint.yaml
    with:
      go-version: ${{ inputs.go-version }}
      use-private-module: ${{ inputs.use-private-module }}
      github-owner: ${{ inputs.github-owner }}
    secrets:
      GH_TOKEN: ${{ secrets.GH_TOKEN }}

  test:
    uses: ./.github/workflows/golangci-test.yaml
    with:
      go-version: ${{ inputs.go-version }}
      use-private-module: ${{ inputs.use-private-module }}
      github-owner: ${{ inputs.github-owner }}
    secrets:
      GH_TOKEN: ${{ secrets.GH_TOKEN }}